
R version 4.4.1 (2024-06-14 ucrt) -- "Race for Your Life"
Copyright (C) 2024 The R Foundation for Statistical Computing
Platform: x86_64-w64-mingw32/x64

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(git2r)
Warning message:
package 'git2r' was built under R version 4.4.3 
> library(DBI) 

Attaching package: 'DBI'

The following object is masked from 'package:git2r':

    fetch

> library(RMySQL)
> library(stringr)
> library(XML)
> library(readr)
> library(readxl)
> library(dplyr)

Attaching package: 'dplyr'

The following object is masked from 'package:git2r':

    pull

The following objects are masked from 'package:stats':

    filter, lag

The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union

> library(magick)
Linking to ImageMagick 6.9.12.98
Enabled features: cairo, freetype, fftw, ghostscript, heic, lcms, pango, raw, rsvg, webp
Disabled features: fontconfig, x11
Warning message:
package 'magick' was built under R version 4.4.3 
> library(base64enc)
> library(httr)

Attaching package: 'httr'

The following objects are masked from 'package:git2r':

    config, content

> library(xlsx)
Warning message:
package 'xlsx' was built under R version 4.4.3 
> 
> setwd("C:/Automatisierungen/investora_feed")
> source("./Tools/Funktionen/Utils.R")
> source("./functions/function_request_chatGPT.R")
> source("./functions/functions_github.R")
> 
> #Path Github Token (do NOT include in Repository)
> WD_GITHUB_TOKEN <- "C:/Github_Token/token.txt"
> 
> #Constants
> INPUT_PATH_XML <- "C:/Dataserver/redsys/investora/"
> INPUT_PATH_PICTURES <- "C:/_Picture_Input_AWP/"
> OUTPUT_PATH_XML <- "./_processed/"
> OUTPUT_PATH_NEWS <- "./XML_News/"
> OUTPUT_PATH_FEED <- "./XML_Feed/"
> 
> #Get Company Data
> mydb <- retry(connectDB(db_name="masterdata"),sleep=5)
Warning message:
package 'futile.logger' was built under R version 4.4.2 
> rs <- dbSendQuery(mydb, "SELECT * FROM companies")
Warning messages:
1: In dbSendQuery(mydb, "SELECT * FROM companies") :
  unrecognized MySQL field type 7 in column 23 imported as character
2: In dbSendQuery(mydb, "SELECT * FROM companies") :
  unrecognized MySQL field type 7 in column 24 imported as character
> company_data <- retry(fetch(rs,n=-1, encoding="utf8"),sleep=5)
> dbDisconnectAll()
1 connection(s) closed.
Warning message:
Closing open result sets 
> 
> ISIN_Firma <- company_data %>%
+   select(Kurzname,ISINs,ID) %>%
+   filter(is.na(ISINs) == FALSE)
> Encoding(ISIN_Firma$Kurzname) <- "UTF-8"
> ISIN_Firma <- ISIN_Firma[,c(2,1,3)]
> colnames(ISIN_Firma) <- c("ISINs","Kurzname","ID")
> 
> #Get Picture Database
> mydb <- retry(connectDB(db_name="picture_delivery_robot"),sleep=5)
> rs <- dbSendQuery(mydb, "SELECT * FROM picture_database WHERE awp_products = 'SwissTopNews'")
Warning message:
In dbSendQuery(mydb, "SELECT * FROM picture_database WHERE awp_products = 'SwissTopNews'") :
  unrecognized MySQL field type 7 in column 16 imported as character
> picture_database <- retry(fetch(rs,n=-1, encoding="utf8"),sleep=5)
> dbDisconnectAll()
1 connection(s) closed.
Warning message:
Closing open result sets 
> picture_database$name <- trimws(picture_database$name)
> picture_database$keywords <- gsub(", ?","|",picture_database$keywords)
> 
> #Filter Pictures not available
> missing_pictures <- read.xlsx("./data/missing_pictures.xlsx",sheetIndex = 1)
> missing_pictures <- paste(missing_pictures$picture_names,collapse = "|")
> 
> picture_database <- picture_database %>%
+   filter(grepl(missing_pictures,picture_name) == FALSE)
> 
> repeat{
+   
+   files <- list.files(path=INPUT_PATH_XML)
+   
+   if (length(files)>0) {
+     Sys.sleep(2)  
+     
+     ###Get Data from XML###
+     source("get_data_from_xml.R")
+     
+     ###Select suited picture###
+     source("select_picture.R")
+     
+     ###Create new item for XML Feed with picture data##
+     source("create_XML_news.R")
+     
+     ###File lÃ¶schen###
+     file.copy(paste0(INPUT_PATH_XML,files[1]),paste0(OUTPUT_PATH_XML,files[1])) 
+     file.remove(paste0(INPUT_PATH_XML,files[1]))  
+     
+     ###Update XML-Feed###
+     source("create_XML_feed.R")
+     
+     ###Github Update
+     source("commit.R")
+     
+   } else {
+     print("No new news found")  
+     break  
+   }
+ }
[1] "XML data extracted"
1 connection(s) closed.
Joining with `by = join_by(picture_name)`
[1] "Picture selected: 298166940.jpg"
[1] NA
[1] "company"
[1] "Roche Holding AG"
1 connection(s) closed.
warning: in the working copy of 'XML_Feed/XML_Feed_Investora_News.xml', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'XML_News/20250825_0000002.xml', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of '_processed/20250825_0000002.xml', LF will be replaced by CRLF the next time Git touches it
[master 15b20dd] commit from Rstudio
 59 files changed, 23 insertions(+), 7064 deletions(-)
 delete mode 100644 _processed/20240918_000133.xml
 delete mode 100644 _processed/20240918_000697.xml
 delete mode 100644 _processed/20240918_000715.xml
 delete mode 100644 _processed/20240918_000717.xml
 delete mode 100644 _processed/20240918_000718.xml
 delete mode 100644 _processed/20240918_000782.xml
 delete mode 100644 _processed/20240918_000842.xml
 delete mode 100644 _processed/20240918_000872.xml
 delete mode 100644 _processed/20240918_000978.xml
 delete mode 100644 _processed/20240918_000980.xml
 delete mode 100644 _processed/20240918_001063.xml
 delete mode 100644 _processed/20240918_001091.xml
 delete mode 100644 _processed/20240918_001371.xml
 delete mode 100644 _processed/20240918_001375.xml
 delete mode 100644 _processed/20240918_001511.xml
 delete mode 100644 _processed/20240918_001559.xml
 delete mode 100644 _processed/20240918_001629.xml
 delete mode 100644 _processed/20240918_001636.xml
 delete mode 100644 _processed/20240918_001731.xml
 delete mode 100644 _processed/20240918_001735.xml
 delete mode 100644 _processed/20240918_001826.xml
 delete mode 100644 _processed/20240918_001880.xml
 delete mode 100644 _processed/20240919_000717.xml
 delete mode 100644 _processed/20240919_000781.xml
 delete mode 100644 _processed/20240919_000864.xml
 delete mode 100644 _processed/20240919_000876.xml
 delete mode 100644 _processed/20240919_000993.xml
 delete mode 100644 _processed/20240919_001022.xml
 delete mode 100644 _processed/20240919_001122.xml
 delete mode 100644 _processed/20240919_001251.xml
 delete mode 100644 _processed/20240919_001544.xml
 delete mode 100644 _processed/20240919_001594.xml
 delete mode 100644 _processed/20240919_001604.xml
 delete mode 100644 _processed/20240919_001699.xml
 delete mode 100644 _processed/20240919_001706.xml
 delete mode 100644 _processed/20240919_001825.xml
 delete mode 100644 _processed/20240919_001900.xml
 delete mode 100644 _processed/20240919_001901.xml
 delete mode 100644 _processed/20250825_0000001.xml
 delete mode 100644 _processed/20250825_0000003.xml
 delete mode 100644 _processed/20250826_0000001.xml
 delete mode 100644 _processed/20250826_0000002.xml
 delete mode 100644 _processed/20250826_0000003.xml
 delete mode 100644 _processed/20250826_0000004.xml
 delete mode 100644 _processed/20250826_0000005.xml
 delete mode 100644 _processed/20250826_0000006.xml
 delete mode 100644 _processed/20250826_0000007.xml
 delete mode 100644 _processed/20250826_0000008.xml
 delete mode 100644 _processed/20250826_0000009.xml
 delete mode 100644 _processed/20250826_0000010.xml
 delete mode 100644 _processed/20250826_0000011.xml
 delete mode 100644 _processed/20250826_0000012.xml
 delete mode 100644 _processed/20250826_0000013.xml
 delete mode 100644 _processed/20250826_0000014.xml
 delete mode 100644 _processed/20250826_0000015.xml
To https://github.com/awp-finanznachrichten/investora_feed.git
   0672d43..15b20dd  master -> master
[1] "XML data extracted"
1 connection(s) closed.
Joining with `by = join_by(picture_name)`
[1] "Picture selected: 226348195.jpg"
[1] NA
[1] "company"
[1] "Molecular Partners AG"
1 connection(s) closed.
warning: in the working copy of 'MAIN_PROCESS.Rout', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'XML_Feed/XML_Feed_Investora_News.xml', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'XML_News/20250825_0000003.xml', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of '_processed/20250825_0000003.xml', LF will be replaced by CRLF the next time Git touches it
[master 98a88c5] commit from Rstudio
 4 files changed, 329 insertions(+), 2 deletions(-)
 create mode 100644 _processed/20250825_0000003.xml
To https://github.com/awp-finanznachrichten/investora_feed.git
   15b20dd..98a88c5  master -> master
[1] "XML data extracted"
1 connection(s) closed.
Joining with `by = join_by(picture_name)`
[1] "Picture selected: 100068083.jpg"
[1] NA
[1] "company"
[1] "Valartis Group AG"
1 connection(s) closed.
warning: in the working copy of 'MAIN_PROCESS.Rout', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'XML_Feed/XML_Feed_Investora_News.xml', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'XML_News/20250826_0000001.xml', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of '_processed/20250826_0000001.xml', LF will be replaced by CRLF the next time Git touches it
[master a29903a] commit from Rstudio
 5 files changed, 130 insertions(+), 17 deletions(-)
 delete mode 100644 XML_News/20250825_0000001.xml
 create mode 100644 _processed/20250826_0000001.xml
To https://github.com/awp-finanznachrichten/investora_feed.git
   98a88c5..a29903a  master -> master
[1] "XML data extracted"
1 connection(s) closed.
Joining with `by = join_by(picture_name)`
[1] "Picture selected: 98378308.jpg"
[1] NA
[1] "company"
[1] "VP Bank AG"
1 connection(s) closed.
warning: in the working copy of 'MAIN_PROCESS.Rout', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'XML_Feed/XML_Feed_Investora_News.xml', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'XML_News/20250826_0000002.xml', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of '_processed/20250826_0000002.xml', LF will be replaced by CRLF the next time Git touches it
[master 25a87d5] commit from Rstudio
 4 files changed, 143 insertions(+), 2 deletions(-)
 create mode 100644 _processed/20250826_0000002.xml
